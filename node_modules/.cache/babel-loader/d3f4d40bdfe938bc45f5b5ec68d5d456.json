{"ast":null,"code":"import _objectSpread from \"C:\\\\Users\\\\khouloud\\\\Documents\\\\PI\\\\MERN_Stack_PI\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";\nimport _regeneratorRuntime from \"C:\\\\Users\\\\khouloud\\\\Documents\\\\PI\\\\MERN_Stack_PI\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _asyncToGenerator from \"C:\\\\Users\\\\khouloud\\\\Documents\\\\PI\\\\MERN_Stack_PI\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nvar _jsxFileName = \"C:\\\\Users\\\\khouloud\\\\Documents\\\\PI\\\\MERN_Stack_PI\\\\src\\\\components\\\\App\\\\App_chat.js\";\nimport React, { Component } from 'react';\nimport './App_chat.css';\nimport MessageList from \"./MessageList\";\nimport MessageForm from \"./MessageForm\";\nimport $ from 'jquery';\n\nvar Twilio = require('twilio-chat');\n\nimport { getToken } from \"../../api\";\n\nclass App_chat extends Component {\n  constructor(props) {\n    var _this;\n\n    super(props);\n    _this = this;\n\n    this.componentDidMount = () => {\n      this.getToken().then(this.createChatClient).then(this.joinGeneralChannel).then(this.configureChannelEvents).catch(error => {\n        this.addMessage({\n          body: \"Error: \".concat(error.message)\n        });\n      });\n    };\n\n    this.getToken = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var userName, response;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) switch (_context.prev = _context.next) {\n          case 0:\n            userName = _this.state.userName;\n            _context.next = 3;\n            return getToken(userName);\n\n          case 3:\n            response = _context.sent;\n            return _context.abrupt(\"return\", response.data.token);\n\n          case 5:\n          case \"end\":\n            return _context.stop();\n        }\n      }, _callee);\n    }));\n\n    this.addMessage = message => {\n      const messageData = _objectSpread({}, message, {\n        me: message.author === this.state.username\n      });\n\n      this.setState({\n        messages: [...this.state.messages, messageData]\n      });\n    };\n\n    this.createChatClient = token => {\n      Twilio.Chat.Client.create(token).then(client => {\n        // Use client\n        console.log(\"yes\", token);\n      });\n    };\n\n    this.joinGeneralChannel = chatClient => {\n      return new Promise((resolve, reject) => {\n        chatClient.getSubscribedChannels().then(() => {\n          chatClient.getChannelByUniqueName('general').then(channel => {// ...\n          }).catch(() => this.createGeneralChannel(chatClient));\n        }).catch(() => reject(Error('Could not get channel list.')));\n      });\n    };\n\n    this.createGeneralChannel = chatClient => {\n      return new Promise((resolve, reject) => {\n        this.addMessage({\n          body: 'Creating general channel...'\n        });\n        chatClient.createChannel({\n          uniqueName: 'general',\n          friendlyName: 'General Chat'\n        }).then(() => this.joinGeneralChannel(chatClient)).catch(() => reject(Error('Could not create general channel.')));\n      });\n    };\n\n    this.configureChannelEvents = channel => {\n      channel.on('messageAdded', ({\n        author,\n        body\n      }) => {\n        this.addMessage({\n          author,\n          body\n        });\n      });\n      channel.on('memberJoined', member => {\n        this.addMessage({\n          body: \"\".concat(member.identity, \" has joined the channel.\")\n        });\n      });\n      channel.on('memberLeft', member => {\n        this.addMessage({\n          body: \"\".concat(member.identity, \" has left the channel.\")\n        });\n      });\n    };\n\n    this.handleNewMessage = text => {\n      if (this.state.channel) {\n        this.state.channel.sendMessage(text);\n      }\n    };\n\n    this.state = {\n      messages: [],\n      username: null,\n      channel: null\n    };\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      className: \"App\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 86\n      },\n      __self: this\n    }, React.createElement(MessageList, {\n      messages: this.state.messages,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 87\n      },\n      __self: this\n    }), React.createElement(MessageForm, {\n      onMessageSend: this.handleNewMessage,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 88\n      },\n      __self: this\n    }));\n  }\n\n}\n\nexport default App_chat;","map":{"version":3,"sources":["C:/Users/khouloud/Documents/PI/MERN_Stack_PI/src/components/App/App_chat.js"],"names":["React","Component","MessageList","MessageForm","$","Twilio","require","getToken","App_chat","constructor","props","componentDidMount","then","createChatClient","joinGeneralChannel","configureChannelEvents","catch","error","addMessage","body","message","userName","state","response","data","token","messageData","me","author","username","setState","messages","Chat","Client","create","client","console","log","chatClient","Promise","resolve","reject","getSubscribedChannels","getChannelByUniqueName","channel","createGeneralChannel","Error","createChannel","uniqueName","friendlyName","on","member","identity","handleNewMessage","text","sendMessage","render"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\r\nimport './App_chat.css'\r\nimport MessageList from \"./MessageList\";\r\nimport MessageForm from \"./MessageForm\";\r\nimport $ from 'jquery';\r\nvar Twilio = require('twilio-chat');\r\nimport { getToken } from \"../../api\";\r\n\r\nclass App_chat extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n            messages: [],\r\n            username: null,\r\n            channel: null,\r\n        }\r\n    }\r\n    componentDidMount = () => {\r\n        this.getToken()\r\n            .then(this.createChatClient)\r\n            .then(this.joinGeneralChannel)\r\n            .then(this.configureChannelEvents)\r\n            .catch((error) => {\r\n                this.addMessage({ body: `Error: ${error.message}` })\r\n            })\r\n    }\r\n    getToken = async () => {\r\n        const { userName } = this.state;\r\n\r\n        const response = await getToken(userName);\r\n        return response.data.token;\r\n    };\r\n    addMessage = (message) => {\r\n        const messageData = { ...message, me: message.author === this.state.username }\r\n        this.setState({\r\n            messages: [...this.state.messages, messageData],\r\n        })\r\n    }\r\n\r\n    createChatClient = (token) => {\r\n        Twilio.Chat.Client.create(token).then(client => {\r\n            // Use client\r\n            console.log(\"yes\",token)\r\n        });\r\n    }\r\n    joinGeneralChannel = (chatClient) => {\r\n        return new Promise((resolve, reject) => {\r\n            chatClient.getSubscribedChannels().then(() => {\r\n                chatClient.getChannelByUniqueName('general').then((channel) => {\r\n                    // ...\r\n                }).catch(() => this.createGeneralChannel(chatClient))\r\n            }).catch(() => reject(Error('Could not get channel list.')))\r\n        })\r\n    }\r\n\r\n    createGeneralChannel = (chatClient) => {\r\n        return new Promise((resolve, reject) => {\r\n            this.addMessage({ body: 'Creating general channel...' })\r\n            chatClient\r\n                .createChannel({ uniqueName: 'general', friendlyName: 'General Chat' })\r\n                .then(() => this.joinGeneralChannel(chatClient))\r\n                .catch(() => reject(Error('Could not create general channel.')))\r\n        })\r\n    }\r\n\r\n    configureChannelEvents = (channel) => {\r\n        channel.on('messageAdded', ({ author, body }) => {\r\n            this.addMessage({ author, body })\r\n        })\r\n\r\n        channel.on('memberJoined', (member) => {\r\n            this.addMessage({ body: `${member.identity} has joined the channel.` })\r\n        })\r\n\r\n        channel.on('memberLeft', (member) => {\r\n            this.addMessage({ body: `${member.identity} has left the channel.` })\r\n        })\r\n    }\r\n    handleNewMessage = (text) => {\r\n        if (this.state.channel) {\r\n            this.state.channel.sendMessage(text)\r\n        }\r\n    }\r\n    render() {\r\n        return (\r\n            <div className=\"App\">\r\n                <MessageList messages={this.state.messages} />\r\n                <MessageForm onMessageSend={this.handleNewMessage} />\r\n            </div>\r\n        )\r\n    }\r\n}\r\n\r\nexport default App_chat\r\n"]},"metadata":{},"sourceType":"module"}