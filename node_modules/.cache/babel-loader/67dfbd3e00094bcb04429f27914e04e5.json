{"ast":null,"code":"'use strict';\n\nvar EventEmitter = require('events').EventEmitter,\n    inherits = require('inherits'),\n    eventUtils = require('../../utils/event'),\n    browser = require('../../utils/browser'),\n    urlUtils = require('../../utils/url');\n\nvar debug = function debug() {};\n\nif (process.env.NODE_ENV !== 'production') {\n  debug = require('debug')('sockjs-client:sender:xdr');\n} // References:\n//   http://ajaxian.com/archives/100-line-ajax-wrapper\n//   http://msdn.microsoft.com/en-us/library/cc288060(v=VS.85).aspx\n\n\nfunction XDRObject(method, url, payload) {\n  debug(method, url);\n  var self = this;\n  EventEmitter.call(this);\n  setTimeout(function () {\n    self._start(method, url, payload);\n  }, 0);\n}\n\ninherits(XDRObject, EventEmitter);\n\nXDRObject.prototype._start = function (method, url, payload) {\n  debug('_start');\n  var self = this;\n  var xdr = new global.XDomainRequest(); // IE caches even POSTs\n\n  url = urlUtils.addQuery(url, 't=' + +new Date());\n\n  xdr.onerror = function () {\n    debug('onerror');\n\n    self._error();\n  };\n\n  xdr.ontimeout = function () {\n    debug('ontimeout');\n\n    self._error();\n  };\n\n  xdr.onprogress = function () {\n    debug('progress', xdr.responseText);\n    self.emit('chunk', 200, xdr.responseText);\n  };\n\n  xdr.onload = function () {\n    debug('load');\n    self.emit('finish', 200, xdr.responseText);\n\n    self._cleanup(false);\n  };\n\n  this.xdr = xdr;\n  this.unloadRef = eventUtils.unloadAdd(function () {\n    self._cleanup(true);\n  });\n\n  try {\n    // Fails with AccessDenied if port number is bogus\n    this.xdr.open(method, url);\n\n    if (this.timeout) {\n      this.xdr.timeout = this.timeout;\n    }\n\n    this.xdr.send(payload);\n  } catch (x) {\n    this._error();\n  }\n};\n\nXDRObject.prototype._error = function () {\n  this.emit('finish', 0, '');\n\n  this._cleanup(false);\n};\n\nXDRObject.prototype._cleanup = function (abort) {\n  debug('cleanup', abort);\n\n  if (!this.xdr) {\n    return;\n  }\n\n  this.removeAllListeners();\n  eventUtils.unloadDel(this.unloadRef);\n  this.xdr.ontimeout = this.xdr.onerror = this.xdr.onprogress = this.xdr.onload = null;\n\n  if (abort) {\n    try {\n      this.xdr.abort();\n    } catch (x) {// intentionally empty\n    }\n  }\n\n  this.unloadRef = this.xdr = null;\n};\n\nXDRObject.prototype.close = function () {\n  debug('close');\n\n  this._cleanup(true);\n}; // IE 8/9 if the request target uses the same scheme - #79\n\n\nXDRObject.enabled = !!(global.XDomainRequest && browser.hasDomain());\nmodule.exports = XDRObject;","map":{"version":3,"sources":["C:/Users/khouloud/Documents/PI/MERN_Stack_PI/node_modules/sockjs-client/lib/transport/sender/xdr.js"],"names":["EventEmitter","require","inherits","eventUtils","browser","urlUtils","debug","process","env","NODE_ENV","XDRObject","method","url","payload","self","call","setTimeout","_start","prototype","xdr","global","XDomainRequest","addQuery","Date","onerror","_error","ontimeout","onprogress","responseText","emit","onload","_cleanup","unloadRef","unloadAdd","open","timeout","send","x","abort","removeAllListeners","unloadDel","close","enabled","hasDomain","module","exports"],"mappings":"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","sourcesContent":["'use strict';\r\n\r\nvar EventEmitter = require('events').EventEmitter\r\n  , inherits = require('inherits')\r\n  , eventUtils = require('../../utils/event')\r\n  , browser = require('../../utils/browser')\r\n  , urlUtils = require('../../utils/url')\r\n  ;\r\n\r\nvar debug = function() {};\r\nif (process.env.NODE_ENV !== 'production') {\r\n  debug = require('debug')('sockjs-client:sender:xdr');\r\n}\r\n\r\n// References:\r\n//   http://ajaxian.com/archives/100-line-ajax-wrapper\r\n//   http://msdn.microsoft.com/en-us/library/cc288060(v=VS.85).aspx\r\n\r\nfunction XDRObject(method, url, payload) {\r\n  debug(method, url);\r\n  var self = this;\r\n  EventEmitter.call(this);\r\n\r\n  setTimeout(function() {\r\n    self._start(method, url, payload);\r\n  }, 0);\r\n}\r\n\r\ninherits(XDRObject, EventEmitter);\r\n\r\nXDRObject.prototype._start = function(method, url, payload) {\r\n  debug('_start');\r\n  var self = this;\r\n  var xdr = new global.XDomainRequest();\r\n  // IE caches even POSTs\r\n  url = urlUtils.addQuery(url, 't=' + (+new Date()));\r\n\r\n  xdr.onerror = function() {\r\n    debug('onerror');\r\n    self._error();\r\n  };\r\n  xdr.ontimeout = function() {\r\n    debug('ontimeout');\r\n    self._error();\r\n  };\r\n  xdr.onprogress = function() {\r\n    debug('progress', xdr.responseText);\r\n    self.emit('chunk', 200, xdr.responseText);\r\n  };\r\n  xdr.onload = function() {\r\n    debug('load');\r\n    self.emit('finish', 200, xdr.responseText);\r\n    self._cleanup(false);\r\n  };\r\n  this.xdr = xdr;\r\n  this.unloadRef = eventUtils.unloadAdd(function() {\r\n    self._cleanup(true);\r\n  });\r\n  try {\r\n    // Fails with AccessDenied if port number is bogus\r\n    this.xdr.open(method, url);\r\n    if (this.timeout) {\r\n      this.xdr.timeout = this.timeout;\r\n    }\r\n    this.xdr.send(payload);\r\n  } catch (x) {\r\n    this._error();\r\n  }\r\n};\r\n\r\nXDRObject.prototype._error = function() {\r\n  this.emit('finish', 0, '');\r\n  this._cleanup(false);\r\n};\r\n\r\nXDRObject.prototype._cleanup = function(abort) {\r\n  debug('cleanup', abort);\r\n  if (!this.xdr) {\r\n    return;\r\n  }\r\n  this.removeAllListeners();\r\n  eventUtils.unloadDel(this.unloadRef);\r\n\r\n  this.xdr.ontimeout = this.xdr.onerror = this.xdr.onprogress = this.xdr.onload = null;\r\n  if (abort) {\r\n    try {\r\n      this.xdr.abort();\r\n    } catch (x) {\r\n      // intentionally empty\r\n    }\r\n  }\r\n  this.unloadRef = this.xdr = null;\r\n};\r\n\r\nXDRObject.prototype.close = function() {\r\n  debug('close');\r\n  this._cleanup(true);\r\n};\r\n\r\n// IE 8/9 if the request target uses the same scheme - #79\r\nXDRObject.enabled = !!(global.XDomainRequest && browser.hasDomain());\r\n\r\nmodule.exports = XDRObject;\r\n"]},"metadata":{},"sourceType":"script"}