{"ast":null,"code":"'use strict';\n\nvar urlUtils = require('./utils/url'),\n    eventUtils = require('./utils/event'),\n    JSON3 = require('json3'),\n    FacadeJS = require('./facade'),\n    InfoIframeReceiver = require('./info-iframe-receiver'),\n    iframeUtils = require('./utils/iframe'),\n    loc = require('./location');\n\nvar debug = function debug() {};\n\nif (process.env.NODE_ENV !== 'production') {\n  debug = require('debug')('sockjs-client:iframe-bootstrap');\n}\n\nmodule.exports = function (SockJS, availableTransports) {\n  var transportMap = {};\n  availableTransports.forEach(function (at) {\n    if (at.facadeTransport) {\n      transportMap[at.facadeTransport.transportName] = at.facadeTransport;\n    }\n  }); // hard-coded for the info iframe\n  // TODO see if we can make this more dynamic\n\n  transportMap[InfoIframeReceiver.transportName] = InfoIframeReceiver;\n  var parentOrigin;\n  /* eslint-disable camelcase */\n\n  SockJS.bootstrap_iframe = function () {\n    /* eslint-enable camelcase */\n    var facade;\n    iframeUtils.currentWindowId = loc.hash.slice(1);\n\n    var onMessage = function onMessage(e) {\n      if (e.source !== parent) {\n        return;\n      }\n\n      if (typeof parentOrigin === 'undefined') {\n        parentOrigin = e.origin;\n      }\n\n      if (e.origin !== parentOrigin) {\n        return;\n      }\n\n      var iframeMessage;\n\n      try {\n        iframeMessage = JSON3.parse(e.data);\n      } catch (ignored) {\n        debug('bad json', e.data);\n        return;\n      }\n\n      if (iframeMessage.windowId !== iframeUtils.currentWindowId) {\n        return;\n      }\n\n      switch (iframeMessage.type) {\n        case 's':\n          var p;\n\n          try {\n            p = JSON3.parse(iframeMessage.data);\n          } catch (ignored) {\n            debug('bad json', iframeMessage.data);\n            break;\n          }\n\n          var version = p[0];\n          var transport = p[1];\n          var transUrl = p[2];\n          var baseUrl = p[3];\n          debug(version, transport, transUrl, baseUrl); // change this to semver logic\n\n          if (version !== SockJS.version) {\n            throw new Error('Incompatible SockJS! Main site uses:' + ' \"' + version + '\", the iframe:' + ' \"' + SockJS.version + '\".');\n          }\n\n          if (!urlUtils.isOriginEqual(transUrl, loc.href) || !urlUtils.isOriginEqual(baseUrl, loc.href)) {\n            throw new Error('Can\\'t connect to different domain from within an ' + 'iframe. (' + loc.href + ', ' + transUrl + ', ' + baseUrl + ')');\n          }\n\n          facade = new FacadeJS(new transportMap[transport](transUrl, baseUrl));\n          break;\n\n        case 'm':\n          facade._send(iframeMessage.data);\n\n          break;\n\n        case 'c':\n          if (facade) {\n            facade._close();\n          }\n\n          facade = null;\n          break;\n      }\n    };\n\n    eventUtils.attachEvent('message', onMessage); // Start\n\n    iframeUtils.postMessage('s');\n  };\n};","map":{"version":3,"sources":["C:/Users/khouloud/Documents/PI/MERN_Stack_PI/node_modules/sockjs-client/lib/iframe-bootstrap.js"],"names":["urlUtils","require","eventUtils","JSON3","FacadeJS","InfoIframeReceiver","iframeUtils","loc","debug","process","env","NODE_ENV","module","exports","SockJS","availableTransports","transportMap","forEach","at","facadeTransport","transportName","parentOrigin","bootstrap_iframe","facade","currentWindowId","hash","slice","onMessage","e","source","parent","origin","iframeMessage","parse","data","ignored","windowId","type","p","version","transport","transUrl","baseUrl","Error","isOriginEqual","href","_send","_close","attachEvent","postMessage"],"mappings":"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","sourcesContent":["'use strict';\r\n\r\nvar urlUtils = require('./utils/url')\r\n  , eventUtils = require('./utils/event')\r\n  , JSON3 = require('json3')\r\n  , FacadeJS = require('./facade')\r\n  , InfoIframeReceiver = require('./info-iframe-receiver')\r\n  , iframeUtils = require('./utils/iframe')\r\n  , loc = require('./location')\r\n  ;\r\n\r\nvar debug = function() {};\r\nif (process.env.NODE_ENV !== 'production') {\r\n  debug = require('debug')('sockjs-client:iframe-bootstrap');\r\n}\r\n\r\nmodule.exports = function(SockJS, availableTransports) {\r\n  var transportMap = {};\r\n  availableTransports.forEach(function(at) {\r\n    if (at.facadeTransport) {\r\n      transportMap[at.facadeTransport.transportName] = at.facadeTransport;\r\n    }\r\n  });\r\n\r\n  // hard-coded for the info iframe\r\n  // TODO see if we can make this more dynamic\r\n  transportMap[InfoIframeReceiver.transportName] = InfoIframeReceiver;\r\n  var parentOrigin;\r\n\r\n  /* eslint-disable camelcase */\r\n  SockJS.bootstrap_iframe = function() {\r\n    /* eslint-enable camelcase */\r\n    var facade;\r\n    iframeUtils.currentWindowId = loc.hash.slice(1);\r\n    var onMessage = function(e) {\r\n      if (e.source !== parent) {\r\n        return;\r\n      }\r\n      if (typeof parentOrigin === 'undefined') {\r\n        parentOrigin = e.origin;\r\n      }\r\n      if (e.origin !== parentOrigin) {\r\n        return;\r\n      }\r\n\r\n      var iframeMessage;\r\n      try {\r\n        iframeMessage = JSON3.parse(e.data);\r\n      } catch (ignored) {\r\n        debug('bad json', e.data);\r\n        return;\r\n      }\r\n\r\n      if (iframeMessage.windowId !== iframeUtils.currentWindowId) {\r\n        return;\r\n      }\r\n      switch (iframeMessage.type) {\r\n      case 's':\r\n        var p;\r\n        try {\r\n          p = JSON3.parse(iframeMessage.data);\r\n        } catch (ignored) {\r\n          debug('bad json', iframeMessage.data);\r\n          break;\r\n        }\r\n        var version = p[0];\r\n        var transport = p[1];\r\n        var transUrl = p[2];\r\n        var baseUrl = p[3];\r\n        debug(version, transport, transUrl, baseUrl);\r\n        // change this to semver logic\r\n        if (version !== SockJS.version) {\r\n          throw new Error('Incompatible SockJS! Main site uses:' +\r\n                    ' \"' + version + '\", the iframe:' +\r\n                    ' \"' + SockJS.version + '\".');\r\n        }\r\n\r\n        if (!urlUtils.isOriginEqual(transUrl, loc.href) ||\r\n            !urlUtils.isOriginEqual(baseUrl, loc.href)) {\r\n          throw new Error('Can\\'t connect to different domain from within an ' +\r\n                    'iframe. (' + loc.href + ', ' + transUrl + ', ' + baseUrl + ')');\r\n        }\r\n        facade = new FacadeJS(new transportMap[transport](transUrl, baseUrl));\r\n        break;\r\n      case 'm':\r\n        facade._send(iframeMessage.data);\r\n        break;\r\n      case 'c':\r\n        if (facade) {\r\n          facade._close();\r\n        }\r\n        facade = null;\r\n        break;\r\n      }\r\n    };\r\n\r\n    eventUtils.attachEvent('message', onMessage);\r\n\r\n    // Start\r\n    iframeUtils.postMessage('s');\r\n  };\r\n};\r\n"]},"metadata":{},"sourceType":"script"}